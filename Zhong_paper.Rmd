---
title: "The Influence of Individual Characterisitcs on Public Transportation Planning"
author: "Iris Zhong"
abstract: xx
thanks: xx
header-includes:
   - \usepackage{booktabs}
   - \usepackage{setspace}
   - \doublespacing
   - \usepackage[labelfont=bf]{caption}
output: 
  pdf_document:
    number_sections: true
    keep_tex: true
# bibliography: sample.bib
---

```{r setup, echo = F, message = F, warning = F}
knitr::opts_chunk$set(results = 'asis', cache = F, warning = F, message = F, echo = F)
library(tidyverse)
library(lubridate)
library(stargazer)
library(corrplot)
library(Hmisc)
library(dlookr)
library(car)
library(patchwork)
library(sf)
library(tmap)
load("processed_data/analysis_data.RData")
load("processed_data/map_data.RData")
```


# Literature Review (Unfinished)

Referendum data, characterized as dichotomously coded from the survey, has been widely used in economic research. The estimation outcome with the referendum approach is compared to that of the individual stochastic valuation approach in Bollino’s paper, which estimates the Italians’ WTP of using renewable energy to produce electricity (2010). The estimated WTP from the referendum approach depends on how the original Likert-scale data is coded into a binary variable, and most of the outcomes are similar to the results from the individual stochastic valuation approach. Even though he ignores the sociodemographic factors in the referendum approach, the study justifies that it can provide similar conclusions with other models. 


Similarly, Burkhardt and Chan (2017) also utilize referendum data to estimate WTP for public goods, but at an aggregate zip code level with a log-likelihood function. They look into thirteen referenda in California and find out the price of the public good is negatively correlated with support for the proposition. For the referenda that failed, they calculate the amount of cost that needs to be cut off for the proposition to pass by finding the difference between WTP and price. Even though my project does not involve assessing voters’ WTP, this procedure should be considered in future studies so that an estimation of the necessary reduction in cost to reach enough support can be computed. 


Allen et al. (2016) study the reasoning of the failure of a referendum on a congestion charging scheme in Edinburgh. Instead of using direct voting data, they conduct a survey after the referendum, which allows them to ask more specific questions. Researchers can gain detailed data by surveying, because the unit of measurement is each individual; however, a possible disadvantage of surveying is that respondents who turn in the questionnaire tend to have stronger attitudes towards the proposal, generating sampling bias. They conclude that people who use cars as the primary transportation mean, demonstrate a misconception of the pricing plan, or question the effectiveness of the scheme at reducing congestion are more likely to oppose it. Their findings can give insights to the similar failure in the Gwinnett referendum. Voters against the proposal could be those who rarely use public transportation and those who are not convinced by the effectiveness of expanding public transit in alleviating the traffic. 


Another crucial factor is the accessibility of the proposed transit system. Kinsey et al. (2010) examine the relationship between the distance to the scheduled railway station and voter turnout by studying the Seattle monorail referendum. They introduce the concept of diffused and concentrated benefit/cost. People who live far from the monorail enjoy the diffused benefit of less traffic congestion, and bear the diffused cost of increased tax. People living close to the rail experience the same diffused benefit and cost, but they also gain the concentrated benefit of easily accessing the public good. Finally, those who live very close to the railway have the same benefits and costs, but they also face the concentrated cost such as inconvenience during construction. Since “people are more strongly motivated to avoid losses than to approach gains,” they expect a higher turnout rate in farther places with votes for “no,” which is verified from their analyses. Besides distance, they also find out precincts with a higher percentage of people of lower socioeconomic status or young people have a lower turnout rate. Interestingly, there is a significant interaction between partisanship and distance, which would be also tested in my study. In essence, the effect of distance on turnout is weakened by partisanship, and vanishes beyond a threshold of distance. Even though my dependent variable is voters’ responses rather than turnout, it can be inferred from Kinsey et al.’s findings that people farther away from the transit system would vote against the referendum more. However, the relationship might be non-linear and requires some form of transformation. Regarding the methods, they utilize the spatial lag model to correct for autocorrelation, which is proper to use in my project as well since both studies use precinct-level data. 

# Background

## current transportation


## Connect Gwinnett: Transit Plan

### Plan overview

### Financing


## referendum

# Data & Methods

## Conceptual model

According to previous research, sociodemographic elements can influence people’s voting decisions in the referendum. For example, the effect of income is mixed: on the one hand, people with higher income will pay a smaller portion of their earnings for the implementation of the plan; on the other hand, they will pay a larger amount of tax. Bollino (2008) finds a positive correlation between income and people’s willingness to pay for renewable resources. Burkhardt and Chan (2017) separate the influence of income from tax, and discover their opposite effects on voting. Therefore, it is worth considering the relationship between income and percentage of supporters in this referendum. Voters’ partisanship attachment is found to be a significant factor as well in Burkhardt and Chan’s (2017) paper. Areas with higher proportions of Republicans are less supportive of fiscally costly propositions. In my project, it can be hypothesized that tracts that have a higher proportion of Trump supporters tend to have a lower percentage of agreement to the proposal.  

In addition, some factors related to transportation can intuitively shape people’s attitudes towards public transit. For example, the areas in which people do not use public transit at all might have a higher percentage of refusal of the proposal, because they have alternative transportation means. People who have to travel a long time to work are more likely to support the extension plan if it helps save time. These two factors serve as controls in the models.

Finally, people favor the proposition if it benefits them. Specifically, tracts that are not covered by public transport at present but will be covered in the expansion plan are predicted to support the proposal more.



## Data

The ballot results of the Gwinnett County referendum on Mar 19th, 2019 is obtained from a website powered by Scytl, a trusted source of election outcomes. The cross-sectional dataset contains the voting information of all 157 precincts in the county. The dependent variable -- the proportion of supporters of the referendum, and the voter turnout rate are calculated from this data source.

The result of the 2016 Presidential Election is chosen to reflect partisanship. A cross-sectional precinct-level election data is obtained from the MIT Election Data and Science Lab website. The number of votes for Trump at each precinct in Gwinnett county comes from this dataset. 

Next, cross-sectional sociodemographic characteristics at the census tract level are found in Census Bureau via an R package called `tidycensus`. The data comes from the American Community Survey 5-year estimate published in 2018. The median age and median income are collected here. In addition, the proportion of white, the percentage of people who go to work by public transportation, and the percentage of people who travel more than an hour to work are calculated by dividing the relevant variables by the total population or the survey sample size. 

The information on whether the tract enjoys the proximity of public transportation now and future can be acquired from spatial maps and analyses. First, a precinct-level shapefile of Gwinnett County made in 2018 is obtained from the Georgia General Assembly. Gwinnett County maps with current and proposed future public transit systems are available on the Gwinnett County government website. I select the short-range expansion plan (Y2020 – 2025) because the cost and benefit of the expansion in the far future are discounted more. After modifications in QGIS software, the maps are then transformed into spatial data readable in R. Five-hundred-meter buffer zones are created around bus and railway routes. The categorical variable *current_plan* has four levels: 1 represents no transportation near this tract at present and in the future; 2 represents the tracts that are accessible to public transit currently but not in the future; 3 stands for the tracts that do not have transit at present but will do in the expansion plan; 4 represents the tracts that have and will have public transit for now and for the future. 

As noted above, both referendum and 2016 election data are collected at the precinct level. However, the other datasets are performed at the census tract level. Therefore, referendum and election data are redistributed by the areas shared by the precinct and the tract. See the data appendix for detailed steps of transformation. 

The final dataset joins the datasets above by GEOID. It is cross-sectional, measured with the unit of the census tract. Since there are 113 census tracts in Gwinnett, the dataset has 113 observations, with no missing data. A description of the variables can be found in *Table 1*. 




\begin{table}
\centering
\caption{Variable definitions}
\label{variableDefinitions}
\begin{tabular}{ll}
\hline
\hline
Variable name      & Description                                   \\
\hline
GEOID          & The geographic identifier of the census tract                 \\
medage        & The median age of the population in the tract               \\
medincome        & The median income of the population in the tract               \\
white\_pct           & The percentage of white population in the tract      \\
public\_pct          & The percentage of people who go to work by public transportation (excluding taxi or cab)      \\
time\_pct           & The percentage of people who travel more than an hour to work      \\
trump\_pct          & The estimated percentage of votes for Donald Trump in that tract      \\
voter\_turnout  & The estimated percentage of voters who voted in this referendum in the tract \\
yes\_pct           & The estimated percentage of voters who voted yes in this referendum in the tract      \\
plan\_yes          & Whether the tract is covered by the public transportation now and in the short-range, \\ & defined by whether any transportation is available within 500 meters. \\ & 1 stands for the tract doesn't have transit both now and in the short-range plan. \\ & 2 stands for the tract has transit now but not in the short-range plan. \\ & 3 stands for the tract that doesn't have transit now and will have in the future.\\ & 4 stands for the tract that has public transit both now and in the future      \\

\hline
\end{tabular}
\end{table}



```{r create summary statistic table, echo = F, results = 'asis'}

stargazer::stargazer(as.data.frame(final_data),
                     label = "summaryStats",
                     title = "Summary statistics",
                     header = F,
                     type = "latex",
                     digits = 2)
```

```{r create correlation matrix}

data_numeric <- final_data %>%
   select(-c(current_plan,GEOID))

data_cor = cor(data_numeric)

data_cor_1 <- rcorr(as.matrix(data_numeric))
M <- data_cor_1$r
p_mat <- data_cor_1$P
corrplot(M, type = "upper", order = "hclust", 
         p.mat = p_mat, sig.level = 0.05)


```

*Table 2* lists the summary statistics. Median income is skewed to the right, with a few tracts demonstrating high income levels. Such a pattern of inequality is universally observed.

The usage of public transit is low. On average, only one percent of the population relies on public transportation to go to work. As proved by later analyses, the distribution is highly skewed, and will be transformed in some models. 
**public_pct max needs to be fixed**

The variable *current_plan* is not in *Table 2* because it is a categorical variable. In sum, 31 tracts do not have access to public transport within 500 meters, both now and in the short-range. There is one tract that is categorized as 2, indicating that it has public transit at present, but not in the short-range proposition. It could be due to the plan of reducing circuitous routing. Twenty-two tracts do not enjoy the proximity of public transport now, but will in the short-range. Lastly, 59 tracts have public transit available both at present and in the short-range plan. Since a level of this variable contains only one value (“2”), problems with degrees of freedom will potentially arise. 

A correlation matrix is created from `corrplot` package to investigate the correlation between each pair of factors (see *Figure ???*). Positive correlations are in blue colors, and negative correlations are in red colors. The magnitude is reflected by the color intensity and the size of the dot. Non-significant (p > 0.05) correlations are marked with a cross. *Current_plan* is omitted in the matrix because it is categorical. The dependent variable *yes_pct* is significantly correlated with every independent variable. *Medage*, *voter_turnout*, *medincome*, *white_pct*, and *trump_pct* are all strongly positively correlated with each other, and all of them are negatively associated with *yes_pct*. Given the number of strong, significant correlations among the factors, it is essential to check collinearity in the regression model. 

The major limitation of the data is the unit conversion from precinct to census tract. Such a method assumes that residents in one precinct have the same characteristics, and population density is identical. Clearly, the assumptions cannot be satisfied in a real dataset. 


## Model specification

Two models are tested in the analysis. 

Model 1 adopts linear regression model with all the original variables:


$yes\_pct_t = \beta_0+\beta_1medincome_t+\beta_2white\_pct_t+\beta_3trump\_pct_t+\beta_4current\_plan_t+\beta_5medage_t+\beta_6public\_pct_t+\beta_7time\_pct_t+\beta_8voter\_turnout_t+\epsilon_t$    

where $t$ indexes census tract. Since all variables are measured in the same scope, no fixed effects are tested. The dependent variable is *yes_pct*, the proportion of supporters of the referendum in a tract. Independent variables include *medincome*, *white_pct*, *trump_pct*, and *current_plan*. For more information about these variables, refer to *Table ???*. I hypothesize that the effect of *medincome* is ambiguous. As explained in the Conceptual Model section,  people with higher income pay a larger amount of tax, but the tax takes up a smaller portion of their earnings compared to those with lower income.  *White_pct* is hypothesized to have a negative effect on *yes_pct*, based on the negative correlation between the two variables. A higher percentage of Trump supporters is expected to predict a lower percentage of votes for “yes” in the referendum, as evidenced by common sense and previous literature (???). Finally, since tracts that do not have public transit now and will have it in the short-range benefit the most from the proposition, I predict that the tracts with this feature will have a higher level of *yes_pct* than the others.

*Medage*, *public_pct*, *time_pct*, and *voter_turnout* add to the model as controls. For example, tracts with higher voter turnout are hypothesized to have a lower *yes_pct*, according to the rule of loss aversion – people who believe the referendum incur losses to them are inclined to participate in the referendum actively and vote against it, but people who like the proposition are less motivated to vote in nature. 




```{r check skewness, include=FALSE}
find_skewness(final_data)
```

*Medincome*, *public_pct* and *voter_turnout* are found to be positively skewed. Thus, Model 2 uses multiple linear regression after log or square root transformation on these three variables. Among them, since many of the values in *public_pct* are 0, a constant has to add to the variable before taking log transformation.

$yes\_pct_t = \beta_0+\beta_1log(medincome_t)+\beta_2white\_pct_t+\beta_3trump\_pct_t+\beta_4current\_plan_t+\beta_5medage_t+\beta_6log(public\_pct_t + 0.01)+\beta_7time\_pct_t+\beta_8\sqrt{voter\_turnout_t}+\epsilon_t$     



# Results & Discussion

## Regression results 

```{r create mod1, include = F}

mod1 <- lm(data = final_data, yes_pct ~ medincome + white_pct + trump_pct 
           + current_plan + medage + public_pct + time_pct +
              voter_turnout)
summary(mod1)
```

```{r generate mod1 table, echo = F, results = 'asis'}

stargazer::stargazer(list(mod1), 
               title = "Primary regression", 
               label = "Primary",
               header = F,
               notes.align = "l")
```

*Table ???* provides the results of Model 1. The equation is statistically significant (F(10, 102) = 113.22, p < 0.05). Adjusted $R^2$ is 0.909, indicating that the independent variables in this specification explain a large portion of the variance in the dependent variable. Consistent with the hypothesis, *medincome* is not a significant predictor of *yes_pct*. *Trump_pct* significantly predicts *yes_pct* as expected, and results in a large coefficient: a one percent increase in the proportion of Trump supporters decreases the percentage of voters in favor of the referendum by 0.886%, holding other variables constant. 

However, unlike the outcome from the correlation matrix (see *Figure ???*), *white_pct* significantly predicts *yes_pct* in a positive direction. A higher percentage of the white population in the tract is associated with higher support of the proposition when holding other explanatory variables constant. 

Another unanticipated result is *current_plan*. In contrast to baseline tracts that do not access public transit service both now and in the short-range (*current_plan 1*), only *current_plan 3* tracts differ from them significantly, in the opposite direction to the hypothesis. That is to say, tracts planned to be newly added to the public transit service have a significantly higher rejection of the proposition than the other tracts. 
The control variables are all significant factors. *Medage* and *public_pct* positively predict the level of *yes_pct*, while *time_pct* and *voter_turnout* negatively predict *yes_pct*.

```{r create transformed dataset, include = F}
data_tf <- final_data %>%
   mutate(log_medincome = log(medincome),
          log_public_pct = log(public_pct + 0.01),
          sqrt_voter_turnout = (voter_turnout)^0.5) %>%
   select(-c(medincome, public_pct, voter_turnout))

```


```{r create mod2, include = F}
mod2 <- lm(data = data_tf, yes_pct ~ log_medincome + white_pct + trump_pct 
           + current_plan + medage + log_public_pct + time_pct +
              sqrt_voter_turnout)
summary(mod2)
```

```{r generate mod2 table, echo = F, results = 'asis'}

stargazer::stargazer(list(mod2), 
               title = "Transformed regression", 
               label = "Transformed",
               header = F,
               notes.align = "l")
```

Model 2 uses multiple linear regression as well, except that the skewed variables *medincome*, *public_pct*, and *voter_turnout* are transformed. The overall outcome is identical to Model 1 (see *Table ???*). After log transformation, the effect of median income is still insignificant. 

```{r plot mod1 residuals, include = F}
mod1resid <- ggplot(mod1, aes(x = predict(mod1),y =resid(mod1))) +
      geom_point() +
   geom_hline(yintercept = 0, color = "coral") +
   labs(title = "Residual plot - Model 1",
        xlab = "predicted values",
        ylab = "residuals")

```


```{r check collinearity mod1, include = F}
vif1 <- vif(mod1)
```

```{r make extreme data frame, include = F}
extreme <- data.frame(medage = c(max(final_data$medage), min(final_data$medage)),
                      medincome = c(max(final_data$medincome), min(final_data$medincome)),
                      white_pct = c(max(final_data$white_pct), min(final_data$white_pct)),
                      public_pct = c(max(final_data$public_pct), min(final_data$public_pct)),
                      time_pct = c(min(final_data$time_pct), max(final_data$time_pct)),
                      trump_pct = c(min(final_data$trump_pct), max(final_data$trump_pct)),
                      voter_turnout = c(min(final_data$voter_turnout), max(final_data$voter_turnout)),
                      current_plan = c(3,2))
                      
extreme <- extreme %>%
   mutate(current_plan = as.factor(current_plan))
```

```{r predict extreme values, include = F}
predict(mod1, newdata = extreme)
```

```{r make mod2 residual plot, include= F}

mod2resid <- ggplot(mod1, aes(x = predict(mod2),y =resid(mod2))) +
      geom_point() +
   geom_hline(yintercept = 0, color = "coral") +
   labs(title = "Residual plot - Model 2",
        xlab = "predicted values",
        ylab = "residuals")

```

```{r, include = F}
vif(mod2)
```

```{r make extreme data_tf, include = F}
extreme_tf <- data.frame(medage = c(max(final_data$medage), min(final_data$medage)),
                      log_medincome = c(max(log(final_data$medincome)), min(log(final_data$medincome))),
                      white_pct = c(max(final_data$white_pct), min(final_data$white_pct)),
                      log_public_pct = c(max(log(final_data$public_pct+0.01)), min(log(final_data$public_pct+0.01))),
                      time_pct = c(min(final_data$time_pct), max(final_data$time_pct)),
                      trump_pct = c(min(final_data$trump_pct), max(final_data$trump_pct)),
                      sqrt_voter_turnout = c(min(sqrt(final_data$voter_turnout)), max(sqrt(final_data$voter_turnout))),
                      current_plan = c(3,2))
                      
extreme_tf <- extreme_tf %>%
   mutate(current_plan = as.factor(current_plan))
```

```{r predict extreme values tf, include = F}
predict(mod2, newdata = extreme_tf)
```

A series of assumptions are examined. First, linearity and homoscedasticity assumptions are met, as illustrated by the residual plots.  Next, because several factors correlate with each other (see *Figure ???*), VIFs are calculated to detect multicollinearity.  Since all of the independent variables exhibit a VIF below 5 in both models, no collinearity issue is detected. Lastly,  there is a potential fault of using linear regression in this dataset. The value of the dependent variable *yes_pct* is restricted to the range of 0 to 1, because it represents a percentage. On the other hand, the predicted outcome from linear regression is unbounded. As a result, I calculate the predicted values from the two models with the actual datasets. The predicted outcome is close to the actual value of *yes_pct*, all between 0 and 1. Then, I continue testing by finding the minimum and maximum values of each independent variable in the dataset (to see the actual minimum and maximum values, see *Table ???*), and plug them into the models accordingly to gain the extreme predicted *yes_pct*. The extreme values for Model 1 are 0.09 and 0.96, and 0.11 and 0.95 in Model 2, all within the interval [0,1]. Therefore, the range of the dependent variable in these two regression models meets the assumption. 


## Discussion

Overall, most of the explanatory and control variables predict the proportion of supporters of the expansion proposition as hypothesized. 

In both models, the median income does not significantly predict *yes_pct*. The finding is consistent with the hypothesis that the effect of income level is complicated by taxes. If more information on the financing plan of the expansion and the details of taxation were available, it would be possible to separate the influence of taxation from income. 

Partisanship attachment is a significant factor, even after controlling for other variables such as income and race. The tracts that have a higher proportion of votes for Trump during the 2016 Election tend to reject the expansion of public transport more. Republicans are usually reluctant to agree on public spending due to the increase in tax incurred.

As for the control variables, the median age positively associates with *yes_pct*, but the coefficient is relatively small. The percentage of people taking public transit to work predicts *yes_pct* positively as well. People who do not regularly utilize public transit benefit less from the expansion because they are likely to have other transportation available, and switching to public transportation generates costs such as registering, and spending time to get familiar with the locations and operation. *Time_pct* negatively predicts *yes_pct*, indicating that the areas in which more people spend over an hour to work tend to disapprove with the proposal. Voter turnout rate is negatively related to the dependent variable, conforming with previous research conclusion that those who disagree with the proposal are more likely to express their opinions.  


### Complications with the *current_plan* variable

```{r}
plan_map <- tm_shape(gwinnett_track_map)  + tm_polygons(col = "current_plan") #+ tm_shape(short_range) + tm_lines()
white_map <- tm_shape(gwinnett_track_map)  + tm_polygons(col = "white_pct")# + tm_shape(short_range) + tm_lines()
trump_map <- tm_shape(gwinnett_track_map)  + tm_polygons(col = "trump_pct")# + tm_shape(short_range) + tm_lines()
vote_map <- tm_shape(gwinnett_track_map)  + tm_polygons(col = "yes_pct") #+ tm_shape(short_range) + tm_lines()
tmap_arrange(plan_map, white_map, trump_map, vote_map)
```

One of the most unforeseen findings is that the tracts that are newly included in the public transit system in the short-range plan have a significantly higher rate of refusal to the proposition. Intuitively, they should support the plan the most, because they are the direct beneficiaries. 

A possible explanation is they are worried about the short-term disturbances due to the construction such as traffic congestion and noises. However, since short-range expansion proposal does not include services that require heavy construction, this speculation is less persuasive. 

Another supposition is that residents in these tracts do not like the idea of “Connecting Gwinnett.” As can be seen from *Figure ???*, the tracts marked with purple in the first map are mostly high in *trump_pct*, *white_pct*, and low in *yes_pct*. It is possible that some sort of segregation still exists, that people in these areas refuse to get connected with other communities that are less "white." In future research, I recommend adding another factor such as the number of hate crimes against racial or ethnic minorities, as a measure of "the level of racism."


### Partisanship as a mediating factor (Unfinished)

```{r, include = F}
ggplot(final_data, aes(x = white_pct, y = yes_pct))+
   geom_point()
```


```{r results = F}
library(psych)
mediate(yes_pct ~ white_pct + (trump_pct), data = final_data, n.iter = 10000)
```
- *yes_pct* ~ *white_pct* positive: transportation history, favor the white
- *trump_pct* is a mediating factor that turns the relationship between *white_pct* and *yes_pct* to negative


```{r eval=FALSE, include=FALSE}
library(MBESS)
with(final_data, mediation(x = white_pct, mediator = trump_pct, dv = yes_pct, bootstrap = TRUE, which.boot = "BCa", B = 10000))
```

```{r}
data_tf_2 <- data_tf %>%
   mutate(cp_3 = as.factor(case_when(current_plan == 3 ~1,
                           current_plan != 3 ~ 0))) 
```


```{r}
mod3 <- lm(data = data_tf_2, yes_pct ~ log_medincome + white_pct 
           + cp_3 + trump_pct + medage + log_public_pct + time_pct +
              sqrt_voter_turnout)
summary(mod3)
mod4 <- lm(data = data_tf_2, yes_pct ~ log_medincome + white_pct +
           cp_3 * trump_pct + medage + log_public_pct + time_pct +
              sqrt_voter_turnout)
summary(mod4)
anova(mod3,mod4)
```

```{r}
data_tf_3 <- data_tf %>%
   mutate(cp_3 = as.factor(case_when(current_plan == 3 ~1,
                           current_plan != 3 ~ 0))) %>%
   filter(cp_3 == 1)
```


```{r}
mod5 <- lm(data = data_tf_3, yes_pct ~ log_medincome + white_pct 
            + trump_pct + medage + log_public_pct + time_pct +
              sqrt_voter_turnout)
summary(mod5)

```

```{r}
data_tf_4 <- data_tf %>%
   mutate(cp_3 = as.factor(case_when(current_plan == 3 ~1,
                           current_plan != 3 ~ 0))) %>%
   filter(cp_3 == 0)
```


```{r}
mod6 <- lm(data = data_tf_4, yes_pct ~ log_medincome + white_pct 
            + trump_pct + medage + log_public_pct + time_pct +
              sqrt_voter_turnout)
summary(mod6)

```




# References
xxx
