---
title: "Data Appendix to \"Name of your paper\""
author: "Iris Zhong"
output: 
  pdf_document:
    toc: true
    number_sections: true
---

```{r setup, echo = F, message = F}
knitr::opts_chunk$set(results = 'asis', cache = F)
library(tidyverse)
library(summarytools)
library(sf)
library(readxl)
st_options(plain.ascii = F,
           style = "rmarkdown",
           footnote = NA,
           subtitle.emphasis = F,
           dfSummary.silent = T,
           dfSummary.valid.col = F,
           tmp.img.dir = "./tmp",
           dfSummary.style = "grid")

#The following custom function simplifies the process of writing dfSummaries to html files
export_summary_table <- function(dfSummary_output){
  data_info <- attr(dfSummary_output, "data_info")
  ds_name <- data_info$Data.frame
  print(dfSummary_output,
      file = str_c("output/", ds_name, "_summary.html"),
      method = "browser",
      report.title = ds_name)
}
```

```{r set dfSummary css style, echo = F, include = F}
st_css()
```


# Raw data


## Gwinnett County 2019 Referendum Dataset
**Citation:** Results—Gwinnett—Election Night Reporting. (n.d.). Retrieved March 11, 2020, from https://results.enr.clarityelections.com/GA/Gwinnett/94961/Web02.225391/#/
  
**DOI:** N/A  
**Date Downloaded:** Mar 11, 2020  
**Filename(s):** raw_data/vote_result.xls *If you have a large number of files you can use a patten (see visit data below)*
**Unit of observation:** Precinct 
**Dates covered:** Mar 19, 2019

### To obtain a copy

Users can visit the website that displays election results at Gwinnett County at https://results.enr.clarityelections.com/GA/Gwinnett/94961/Web02.225391/#/ and choose the **Detail XLS** link at the bottom right corner. 

The xls file contains three spreadsheets. I will be using the second and third sheet. 

### Importable version

**Filename(s):** importable_data/vote_result_importable.xlsx

The raw dataset is hard to be imported to R directly because of the following reasons. First, it has three tabs. Second, the top two rows do not contain any useful information or should be incorporated to the next row. The file uses the extension .xls, which is imcompatible with R. Therefore, an importable version of the dataset was created.

Here are the steps:

1. The original file was opened in Microsoft Excel.  
2. The turnout rate for each precinct which was displayed in the second spreadsheet was moved to the third spreadsheet.
3. The first and second spreadsheets were deleted.
4. The top two rows of the third spreadsheet were removed.
5. The columns were renamed to reflect whether the vote was for or against the proposal.
6. The extension was changed from .xls to .xlsx. 


### Variable descriptions

I cannot find any information that describes the variables in this dataset. Therefore, the description below is my understanding. 

- **precinct:** The name of the precinct. 
- **registered_voters:** The number of registered voters in the precinct.
- **total_votes:** The number of votes received in this referendum.
- **voter_turnout:** The percentage of voters who voted in this referendum. ($reigstered\_voters/total\_votes$) 
- **election_day_yes:** The number of people who voted yes during the election day.
- **absentee_mail_yes:** The number of people who voted yes by mailing paper ballots prior to the election day.
- **advance_in_person_1_yes:** The number of people who voted yes prior to the election day.
- **advance_in_person_2_yes:** The number of people who voted yes prior to the election day. The difference between this variable from the previous one is not clear. My speculation is they record people voting on different days before election.
- **provisional_yes:** The number of people who voted yes but had questions in their eligibility. 
- **votes_yes:** The number of people who voted yes in total. (the sum of the previous five variables)
- **election_day_no:** The number of people who voted no during the election day.
- **absentee_mail_no:** The number of people who voted no by mailing paper ballots prior to the election day.
- **advance_in_person_1_no:** The number of people who voted no prior to the election day.
- **advance_in_person_2_no:** The number of people who voted no prior to the election day. The difference between this variable from the previous one is not clear. My speculation is they record people voting on different days before election.
- **provisional_no:** The number of people who voted no but had questions in their eligibility. 
- **votes_no:** The number of people who voted no in total. (the sum of the previous five variables)



### Data import code and summary

```{r}
vote_result <- read_excel("importable_data/vote_result_importable.xlsx", 
    col_types = c("text", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", "numeric", "numeric", 
        "numeric"))
View(vote_result)
export_summary_table(dfSummary(vote_result))
```



## Gwinnett County Census Data
**Citation:** Results—Gwinnett—Election Night Reporting. (n.d.). Retrieved March 11, 2020, from https://results.enr.clarityelections.com/GA/Gwinnett/94961/Web02.225391/#/
  
**DOI:** N/A  
**Date Downloaded:** Mar 11, 2020  
**Filename(s):** raw_data/vote_result.xls *If you have a large number of files you can use a patten (see visit data below)*
**Unit of observation:** Precinct 
**Dates covered:** Mar 19, 2019

### To obtain a copy

Users can visit the website that displays election results at Gwinnett County at https://results.enr.clarityelections.com/GA/Gwinnett/94961/Web02.225391/#/ and choose the **Detail XLS** link at the bottom right corner. 

The xls file contains three spreadsheets. What I will be using is the third sheet. 

### Importable version

**Filename(s):** importable_data/vote_result_importable.xls

The raw dataset is hard to be imported to R directly because of the following reasons. First, it has three tabs. Second, the top two rows do not contain any useful information or should be incorporated to the next row. Therefore, an importable version of the dataset was created.

Here are the steps:

1. The original file was opened in Microsoft Excel.  
2. The first and the second spreadsheets were removed. 
3. Columns H through AI (RecreationVisits through MiscellaneousOvernightStaysTotal) were highlighted and
formatted as numbers with no decimal places and no 1000 separators.  
4. The file was saved using the CSV(comma delimited) format in the importable_data folder.  

*Note:* This procedure violates one of my principles of data analysis: avoid doing the same thing over and over again. It's usually possible to get the computer to do it for you. In this case, we could get R to read in the original files directly by specifying column types and defining a special function to read-in the data. I did not do this in the demonstration file for two reasons:

1. To demonstrate how to document the process if you have to modify your raw files before importing.  
1. Because there are only a couple files, it may be faster to make this change manually than to figure out the code needed to automate it. Whether this is true or not depends on the number of files you need to modify, the likelihood that you'll have to redo it (e.g. if you decided to add years to your analysis later), and your experience with writing code. Check with me if you find yourself wondering whether you should automate something or do it manually (or see [this xkcd comic](https://imgs.xkcd.com/comics/is_it_worth_the_time_2x.png))


### Variable descriptions

Create a bullet list with the name of each variable in the dataset followed by any information the user would need to understand it.

- **variable_name:** Variable description. 
- **variable_name2:** Description of second variable.

### Data import code and summary

```{r}
library(tidycensus)
v18 <- load_variables(2018, "acs5", cache = TRUE)
```


```{r}

cbdata <- get_acs(geography = "tract", 
              variables = c(medincome = "B19013_001", 
                            medage = "B01002_001", 
                            total = "B01001_001", 
                            white = "B01001A_001", 
                            transportation_total = "B08006_001", 
                            car = "B08006_002", 
                            public = "B08006_008", 
                            bike = "B08006_014", 
                            walk = "B08006_015", 
                            other = "B08006_016", 
                            no_transport = "B08006_017"),
              state = "GA", 
              county = "Gwinnett",
              year = 2018)
cbdata
```

```{r}
cbdata_tidy <- cbdata %>%
  select(-moe) %>%
  pivot_wider(names_from = variable, values_from = estimate)
```

*Once you've described the variables, enter an R chunk by selecting Code -> Insert Chunk, or Ctrl+Alt+I, give it a name to describe the dataset you are importing. After importing, export a dataframe summary using the command.*

`export_summary_table(dfSummary(dataset_name))`




# Data Processing and Combination
*This section should include a discussion of the processing and merging steps needed to create your basic data. The code to implement these steps should be included in chunks in this section. Once the final merged data has been created, you should use the dfSummary function again to summarize the data you will be using. You should also save a file containing all the objects you will use in your final analysis to the processed_data folder.*

# Analysis Variables

This section should include a description of all the variables that are used in your final analysis. At the end of the section, you should save all of these variables in the processed_data folder of your repository.

# Discussion of Data

*This section should include a discussion of any data patterns you notice based on the summaries created in the code above.*
